package com.example.samuraitravel.controller;

import org.springframework.ui.Model;

import com.example.samuraitravel.repository.HouseRepository;

@Controller
@RequestMapping("/houses")
public class HouseController {
	private final HouseRepository houseRepository;
	
	public HouseRepository(HouseRepository houseRepository) {
		this.houseRepository = houseRepository;
	}
	
	@GetMapping
	public String index(@RequestParam(name="keyword",required=false) String keyword,
						@RequestParam(name="area",required=false)String area,
						@RequestParam(name="price",required=false)Integer price,
						@PageableDefault(page=0,size=10,sort="id",direction=Direction.ASC)Pageable pageable,
						Model model)
	{
		Page<House> housePage;
		
		if(keyword != null && !keyword.isEmpty()) {
			housePage = houseRepository.findByNameLikeOrAddressLike("%"+ keyword +"%", "%"+keyword+"%", pageable);
		}else if(area !=null && !area.isEmpty()) {
			housePage=houseRepository.findByAddressLike("%"+area+"%", pageable);
		}else if(price != null) {
			housePage=houseRepository.findByPriceLessThanEqual(price, pageable);
		}else {
			housePage = houseRepository.findAll(pageable);
		}
		
		model.addAttribute("housePage",housePage);
		model.addAttribute("keyword",keyword);
		model.addAttribute("area",area);
		model.addAttribute("price",price);
		
		return "houses/index";
	}

}
